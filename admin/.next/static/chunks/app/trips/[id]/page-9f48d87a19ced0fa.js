(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[97],{3322:function(e,a,t){Promise.resolve().then(t.bind(t,6815))},6815:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return i}});var s=t(7437),l=t(2265),r=t(9376),n=t(8020);function i(){let e=(0,r.useParams)(),a=(0,r.useRouter)(),t=e.id,[i,c]=(0,l.useState)(null),[o,d]=(0,l.useState)(!0),[u,m]=(0,l.useState)(!1);(0,l.useEffect)(()=>{x()},[t]);let x=async()=>{try{let e=await fetch("/api/trips/".concat(t));if(e.ok){let a=await e.json();c(a.trip)}}catch(e){console.error("Failed to fetch trip:",e)}finally{d(!1)}},h=async e=>{e.preventDefault(),m(!0);try{(await fetch("/api/trips/".concat(t),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)})).ok?(alert("บันทึกสำเร็จ!"),a.push("/trips")):alert("เกิดข้อผิดพลาด")}catch(e){alert("เกิดข้อผิดพลาด: "+e)}finally{m(!1)}};return o?(0,s.jsx)("div",{className:"flex justify-center items-center h-screen",children:(0,s.jsx)("div",{className:"spinner"})}):i?(0,s.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsx)("button",{onClick:()=>a.push("/trips"),className:"text-gray-600 hover:text-gray-900 mb-4",children:"← กลับ"}),(0,s.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"แก้ไขทริป"})]}),(0,s.jsxs)("form",{onSubmit:h,className:"space-y-6",children:[(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"ข้อมูลพื้นฐาน"}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)(n.Z,{currentImage:i.image_url,onImageUpload:async e=>{console.log("Uploading image:",e.name);let a="/images/trips/".concat(e.name);return c({...i,image_url:a}),a},onImageRemove:()=>{c({...i,image_url:null})},label:"รูปภาพหลักทริป",aspectRatio:"16:9"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"form-label",children:"ชื่อทริป"}),(0,s.jsx)("input",{type:"text",value:i.title||i.name||"",onChange:e=>c({...i,title:e.target.value,name:e.target.value}),className:"form-input",required:!0})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"form-label",children:"คำอธิบายสั้น"}),(0,s.jsx)("textarea",{value:i.description||"",onChange:e=>c({...i,description:e.target.value}),className:"form-input min-h-[100px]",required:!0})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"form-label",children:"คำอธิบายเต็ม"}),(0,s.jsx)("textarea",{value:i.content||"",onChange:e=>c({...i,content:e.target.value}),className:"form-input min-h-[200px]"})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"form-label",children:"ราคา"}),(0,s.jsx)("input",{type:"text",value:i.price||"",onChange:e=>c({...i,price:e.target.value}),className:"form-input",placeholder:"เช่น 1,500 บาท"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"form-label",children:"ระยะเวลา"}),(0,s.jsx)("input",{type:"text",value:i.duration||"",onChange:e=>c({...i,duration:e.target.value}),className:"form-input",placeholder:"เช่น 1 วัน, ครึ่งวัน"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"form-label",children:"ความจุ"}),(0,s.jsx)("input",{type:"text",value:i.capacity||"",onChange:e=>c({...i,capacity:e.target.value}),className:"form-input",placeholder:"เช่น 10-15 คน"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"form-label",children:"สถานที่"}),(0,s.jsx)("input",{type:"text",value:i.location||"",onChange:e=>c({...i,location:e.target.value}),className:"form-input",placeholder:"เช่น คลองบางมด"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"form-label",children:"สถานะ"}),(0,s.jsxs)("select",{value:i.status||"draft",onChange:e=>c({...i,status:e.target.value}),className:"form-input",children:[(0,s.jsx)("option",{value:"draft",children:"ร่าง"}),(0,s.jsx)("option",{value:"published",children:"เผยแพร่"})]})]})]})]}),(0,s.jsxs)("div",{className:"flex justify-end space-x-4",children:[(0,s.jsx)("button",{type:"button",onClick:()=>a.push("/trips"),className:"btn-secondary",children:"ยกเลิก"}),(0,s.jsx)("button",{type:"submit",disabled:u,className:"btn-primary disabled:opacity-50",children:u?"กำลังบันทึก...":"บันทึกการเปลี่ยนแปลง"})]})]})]}):(0,s.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:"ไม่พบทริป"}),(0,s.jsx)("button",{onClick:()=>a.push("/trips"),className:"btn-primary",children:"กลับไปหน้ารายการทริป"})]})})}},8020:function(e,a,t){"use strict";t.d(a,{Z:function(){return r}});var s=t(7437),l=t(2265);function r(e){let{currentImage:a,onImageUpload:t,onImageRemove:r,label:n="รูปภาพ",aspectRatio:i="16:9",maxSizeMB:c=5}=e,[o,d]=(0,l.useState)(a||null),[u,m]=(0,l.useState)(!1),[x,h]=(0,l.useState)(null),p=(0,l.useRef)(null),f=async e=>{var s;let l=null===(s=e.target.files)||void 0===s?void 0:s[0];if(!l)return;if(h(null),!l.type.startsWith("image/")){h("กรุณาเลือกไฟล์รูปภาพเท่านั้น");return}let r=l.size/1048576;if(r>c){h("ไฟล์มีขนาดใหญ่เกินไป (".concat(r.toFixed(2)," MB) กรุณาเลือกไฟล์ที่มีขนาดไม่เกิน ").concat(c," MB"));return}let n=new FileReader;n.onloadend=()=>{d(n.result)},n.readAsDataURL(l),m(!0);try{let e=await t(l);console.log("Image uploaded successfully:",e)}catch(e){h(e instanceof Error?e.message:"เกิดข้อผิดพลาดในการอัปโหลด"),d(a||null)}finally{m(!1)}},v=()=>{switch(i){case"1:1":return"aspect-square";case"4:3":return"aspect-[4/3]";default:return"aspect-video"}};return(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:n}),o?(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsxs)("div",{className:"relative ".concat(v()," w-full overflow-hidden rounded-lg bg-gray-100"),children:[(0,s.jsx)("img",{src:o,alt:"Preview",className:"w-full h-full object-cover"}),u&&(0,s.jsx)("div",{className:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center",children:(0,s.jsx)("div",{className:"spinner border-white"})})]}),(0,s.jsx)("button",{type:"button",onClick:()=>{r&&r(),d(null),p.current&&(p.current.value="")},disabled:u,className:"absolute top-2 right-2 bg-red-600 text-white p-2 rounded-full hover:bg-red-700 disabled:opacity-50 disabled:cursor-not-allowed",children:(0,s.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}):(0,s.jsxs)("div",{onClick:()=>{var e;return null===(e=p.current)||void 0===e?void 0:e.click()},className:"".concat(v()," w-full border-2 border-dashed border-gray-300 rounded-lg flex flex-col items-center justify-center cursor-pointer hover:border-indigo-500 hover:bg-indigo-50 transition-colors"),children:[(0,s.jsx)("svg",{className:"w-12 h-12 text-gray-400 mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),(0,s.jsx)("p",{className:"text-sm text-gray-600",children:"คลิกเพื่อเลือกรูปภาพ"}),(0,s.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:["PNG, JPG, WEBP (ไม่เกิน ",c," MB)"]})]}),(0,s.jsx)("input",{ref:p,type:"file",accept:"image/*",onChange:f,className:"hidden"}),x&&(0,s.jsx)("div",{className:"text-sm text-red-600",children:x}),u&&(0,s.jsx)("div",{className:"text-sm text-indigo-600",children:"กำลังอัปโหลด..."})]})}},9376:function(e,a,t){"use strict";var s=t(5475);t.o(s,"useParams")&&t.d(a,{useParams:function(){return s.useParams}}),t.o(s,"useRouter")&&t.d(a,{useRouter:function(){return s.useRouter}})}},function(e){e.O(0,[971,117,744],function(){return e(e.s=3322)}),_N_E=e.O()}]);