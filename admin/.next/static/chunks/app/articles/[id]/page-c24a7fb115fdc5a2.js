(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[422],{2688:function(e,s,t){Promise.resolve().then(t.bind(t,1997))},1997:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return i}});var a=t(7437),l=t(2265),r=t(9376),n=t(8020);function i(){let e=(0,r.useParams)(),s=(0,r.useRouter)(),t=e.id,[i,c]=(0,l.useState)(null),[o,d]=(0,l.useState)(!0),[u,m]=(0,l.useState)(!1);(0,l.useEffect)(()=>{h()},[t]);let h=async()=>{try{let e=await fetch("/api/articles/".concat(t));if(e.ok){let s=await e.json();c(s.article)}}catch(e){console.error("Failed to fetch article:",e)}finally{d(!1)}},x=async e=>{e.preventDefault(),m(!0);try{(await fetch("/api/articles/".concat(t),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)})).ok?(alert("บันทึกสำเร็จ!"),s.push("/articles")):alert("เกิดข้อผิดพลาด")}catch(e){alert("เกิดข้อผิดพลาด: "+e)}finally{m(!1)}};return o?(0,a.jsx)("div",{className:"flex justify-center items-center h-screen",children:(0,a.jsx)("div",{className:"spinner"})}):i?(0,a.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("button",{onClick:()=>s.push("/articles"),className:"text-gray-600 hover:text-gray-900 mb-4",children:"← กลับ"}),(0,a.jsxs)("h1",{className:"text-3xl font-bold text-gray-900",children:["แก้ไขบทความ: ",i.title]})]}),(0,a.jsxs)("form",{onSubmit:x,className:"space-y-6",children:[(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"ข้อมูลบทความ"}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)(n.Z,{currentImage:i.image_url,onImageUpload:async e=>{let s="/images/articles/".concat(e.name);return c({...i,image_url:s}),s},onImageRemove:()=>{c({...i,image_url:null})},label:"รูปภาพปกบทความ",aspectRatio:"16:9"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"form-label",children:"หัวข้อบทความ"}),(0,a.jsx)("input",{type:"text",value:i.title||"",onChange:e=>c({...i,title:e.target.value}),className:"form-input",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"form-label",children:"คำอธิบายสั้น"}),(0,a.jsx)("textarea",{value:i.description||"",onChange:e=>c({...i,description:e.target.value}),className:"form-input min-h-[100px]",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"form-label",children:"เนื้อหาบทความ"}),(0,a.jsx)("textarea",{value:i.content||"",onChange:e=>c({...i,content:e.target.value}),className:"form-input min-h-[300px]",required:!0})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"form-label",children:"ผู้เขียน"}),(0,a.jsx)("input",{type:"text",value:i.author||"",onChange:e=>c({...i,author:e.target.value}),className:"form-input"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"form-label",children:"หมวดหมู่"}),(0,a.jsxs)("select",{value:i.category||"community",onChange:e=>c({...i,category:e.target.value}),className:"form-input",children:[(0,a.jsx)("option",{value:"community",children:"ชุมชน"}),(0,a.jsx)("option",{value:"education",children:"การศึกษา"}),(0,a.jsx)("option",{value:"travel",children:"การท่องเที่ยว"}),(0,a.jsx)("option",{value:"events",children:"กิจกรรม"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"form-label",children:"สถานะ"}),(0,a.jsxs)("select",{value:i.status||"draft",onChange:e=>c({...i,status:e.target.value}),className:"form-input",children:[(0,a.jsx)("option",{value:"draft",children:"ร่าง"}),(0,a.jsx)("option",{value:"published",children:"เผยแพร่"})]})]})]})]})]}),(0,a.jsxs)("div",{className:"flex justify-end space-x-4",children:[(0,a.jsx)("button",{type:"button",onClick:()=>s.push("/articles"),className:"btn-secondary",children:"ยกเลิก"}),(0,a.jsx)("button",{type:"submit",disabled:u,className:"btn-primary disabled:opacity-50",children:u?"กำลังบันทึก...":"บันทึกการเปลี่ยนแปลง"})]})]})]}):(0,a.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:"ไม่พบบทความ"}),(0,a.jsx)("button",{onClick:()=>s.push("/articles"),className:"btn-primary",children:"กลับ"})]})})}},8020:function(e,s,t){"use strict";t.d(s,{Z:function(){return r}});var a=t(7437),l=t(2265);function r(e){let{currentImage:s,onImageUpload:t,onImageRemove:r,label:n="รูปภาพ",aspectRatio:i="16:9",maxSizeMB:c=5}=e,[o,d]=(0,l.useState)(s||null),[u,m]=(0,l.useState)(!1),[h,x]=(0,l.useState)(null),p=(0,l.useRef)(null),f=async e=>{var a;let l=null===(a=e.target.files)||void 0===a?void 0:a[0];if(!l)return;if(x(null),!l.type.startsWith("image/")){x("กรุณาเลือกไฟล์รูปภาพเท่านั้น");return}let r=l.size/1048576;if(r>c){x("ไฟล์มีขนาดใหญ่เกินไป (".concat(r.toFixed(2)," MB) กรุณาเลือกไฟล์ที่มีขนาดไม่เกิน ").concat(c," MB"));return}let n=new FileReader;n.onloadend=()=>{d(n.result)},n.readAsDataURL(l),m(!0);try{let e=await t(l);console.log("Image uploaded successfully:",e)}catch(e){x(e instanceof Error?e.message:"เกิดข้อผิดพลาดในการอัปโหลด"),d(s||null)}finally{m(!1)}},v=()=>{switch(i){case"1:1":return"aspect-square";case"4:3":return"aspect-[4/3]";default:return"aspect-video"}};return(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:n}),o?(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsxs)("div",{className:"relative ".concat(v()," w-full overflow-hidden rounded-lg bg-gray-100"),children:[(0,a.jsx)("img",{src:o,alt:"Preview",className:"w-full h-full object-cover"}),u&&(0,a.jsx)("div",{className:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center",children:(0,a.jsx)("div",{className:"spinner border-white"})})]}),(0,a.jsx)("button",{type:"button",onClick:()=>{r&&r(),d(null),p.current&&(p.current.value="")},disabled:u,className:"absolute top-2 right-2 bg-red-600 text-white p-2 rounded-full hover:bg-red-700 disabled:opacity-50 disabled:cursor-not-allowed",children:(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}):(0,a.jsxs)("div",{onClick:()=>{var e;return null===(e=p.current)||void 0===e?void 0:e.click()},className:"".concat(v()," w-full border-2 border-dashed border-gray-300 rounded-lg flex flex-col items-center justify-center cursor-pointer hover:border-indigo-500 hover:bg-indigo-50 transition-colors"),children:[(0,a.jsx)("svg",{className:"w-12 h-12 text-gray-400 mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"คลิกเพื่อเลือกรูปภาพ"}),(0,a.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:["PNG, JPG, WEBP (ไม่เกิน ",c," MB)"]})]}),(0,a.jsx)("input",{ref:p,type:"file",accept:"image/*",onChange:f,className:"hidden"}),h&&(0,a.jsx)("div",{className:"text-sm text-red-600",children:h}),u&&(0,a.jsx)("div",{className:"text-sm text-indigo-600",children:"กำลังอัปโหลด..."})]})}},9376:function(e,s,t){"use strict";var a=t(5475);t.o(a,"useParams")&&t.d(s,{useParams:function(){return a.useParams}}),t.o(a,"useRouter")&&t.d(s,{useRouter:function(){return a.useRouter}})}},function(e){e.O(0,[971,117,744],function(){return e(e.s=2688)}),_N_E=e.O()}]);