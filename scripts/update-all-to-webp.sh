#!/bin/bash

# üîÑ ‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÇ‡∏Ñ‡πâ‡∏î‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏†‡∏≤‡∏û .webp
# ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏≤‡∏£‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡∏†‡∏≤‡∏û .jpg/.png/.jpeg/.avif ‡∏î‡πâ‡∏ß‡∏¢ .webp

echo "üîÑ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÇ‡∏Ñ‡πâ‡∏î‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏†‡∏≤‡∏û .webp..."

# ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏≤‡∏£‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡∏†‡∏≤‡∏û‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå
update_image_references() {
    local file_path="$1"
    local temp_file="${file_path}.tmp"
    
    # ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏≤‡∏£‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡∏†‡∏≤‡∏û .jpg/.jpeg/.png/.avif ‡∏î‡πâ‡∏ß‡∏¢ .webp
    
    # ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà src=".../image.jpg" ‡πÄ‡∏õ‡πá‡∏ô src=".../image.webp"
    sed 's|src="\([^"]*\)\.\(jpg\|jpeg\|png\|avif\)"|src="\1.webp"|g' "$file_path" > "$temp_file"
    
    # ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà background-image: url(.../image.jpg) ‡πÄ‡∏õ‡πá‡∏ô background-image: url(.../image.webp)
    sed 's|url(\([^)]*\)\.\(jpg\|jpeg\|png\|avif\))|url(\1.webp)|g' "$temp_file" > "$file_path"
    
    # ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà onerror="this.src='.../image.jpg'" ‡πÄ‡∏õ‡πá‡∏ô onerror="this.src='.../image.webp'"
    sed 's|onerror="this\.src='\''\([^'\'']*\)\.\(jpg\|jpeg\|png\|avif\)'\''|onerror="this.src='\''\1.webp'\''|g' "$file_path" > "$temp_file"
    
    # ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà this.src = '.../image.jpg' ‡πÄ‡∏õ‡πá‡∏ô this.src = '.../image.webp'
    sed 's|this\.src = '\''\([^'\'']*\)\.\(jpg\|jpeg\|png\|avif\)'\''|this.src = '\''\1.webp'\''|g' "$temp_file" > "$file_path"
    
    # ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà this.src = ".../image.jpg" ‡πÄ‡∏õ‡πá‡∏ô this.src = ".../image.webp"
    sed 's|this\.src = "\([^"]*\)\.\(jpg\|jpeg\|png\|avif\)"|this.src = "\1.webp"|g' "$file_path" > "$temp_file"
    
    # ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà const imageUrl = '.../image.jpg' ‡πÄ‡∏õ‡πá‡∏ô const imageUrl = '.../image.webp'
    sed 's|const imageUrl = '\''\([^'\'']*\)\.\(jpg\|jpeg\|png\|avif\)'\''|const imageUrl = '\''\1.webp'\''|g' "$temp_file" > "$file_path"
    
    # ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà const imageUrl = ".../image.jpg" ‡πÄ‡∏õ‡πá‡∏ô const imageUrl = ".../image.webp"
    sed 's|const imageUrl = "\([^"]*\)\.\(jpg\|jpeg\|png\|avif\)"|const imageUrl = "\1.webp"|g' "$file_path" > "$temp_file"
    
    # ‡∏•‡∏ö‡πÑ‡∏ü‡∏•‡πå‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß
    rm "$temp_file"
    
    echo "‚úÖ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï: $file_path"
}

# ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÑ‡∏ü‡∏•‡πå HTML
echo "üîÑ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÑ‡∏ü‡∏•‡πå HTML..."
for html_file in *.html pages/*.html; do
    if [ -f "$html_file" ]; then
        update_image_references "$html_file"
    fi
done

# ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÑ‡∏ü‡∏•‡πå CSS
echo "üîÑ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÑ‡∏ü‡∏•‡πå CSS..."
for css_file in css/*.css; do
    if [ -f "$css_file" ]; then
        update_image_references "$css_file"
    fi
done

# ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÑ‡∏ü‡∏•‡πå JavaScript
echo "üîÑ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÑ‡∏ü‡∏•‡πå JavaScript..."
for js_file in js/*.js; do
    if [ -f "$js_file" ]; then
        update_image_references "$js_file"
    fi
done

echo ""
echo "üéâ ‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÇ‡∏Ñ‡πâ‡∏î‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏†‡∏≤‡∏û .webp!"
echo ""
echo "üí° ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ï‡πà‡∏≠‡πÑ‡∏õ:"
echo "   1. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÉ‡∏ô‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå"
echo "   2. ‡∏ó‡∏î‡∏™‡∏≠‡∏ö fallback ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡πÄ‡∏Å‡πà‡∏≤"
echo "   3. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î"
echo "   4. Deploy ‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå"
